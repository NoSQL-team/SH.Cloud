noskool social network
======================
### Общая структура:
![Main struct](https://github.com/NoSQL-team/noskool/raw/readme_images/img/main_struct.png)
___________________________________________________________________________________________
Фитчи:
* генерация ленты
* социальные отношения (друг — подписчик — никто)
* авторизация
* лайки постов
* комментарии постов

По структурно:
1. HTTP-server — принимает http-запросы от клиента, передаёт роутеру очередей
2. Queue router — делегирует запросы очередям (несколько очередей для уменьшения нагрузки на них, по сути инстансы одного класса)
3. Service queue — очередь сервера, то же инстансы одинаковые
4. Service auth — работает с токенами. Под его управлением БД с id всех пользователей и их токенами, если пользователь аутентифицирован, API:
    * Запрос аутентифицирован ли пользователь.
    * Запрос аутентификации по логину и паролю.
    * Запрос на выход из аккаунта
    * Запрос на добавление нового пользователя
Максимально простая схема, без системы двух токенов (access и refresh)
5. Service users — работает с данными пользователей. API:
    * Запрос на создание пользователя
        1. Создание его в БД
        2. Запрос auth сервиса на создание пользователя
    * Запрос на данные пользователя
    * Запрос всех пользователей
    * Запрос на удаление пользователя
        1. Запрос auth сервиса аутентифицирован ли пользователь
        2. Запрос в БД
    * Запрос на изменение данных пользователя
        1. Запрос auth сервиса аутентифицирован ли пользователь
        2. Запрос в БД
6. Service post — работает с постами. API:
    * Запрос постов для пользователя
        1. Запрос auth сервиса аутентифицирован ли пользователь
        2. Запрос auth сервиса получения id пользователя для выборки его друзей
        3. Запрос в friens сервис друзей пользователя
        4. Запрос в БД постов на основе выборки друзей
    * Запрос всех постов
    * Запрос постов пользователя
        1. Запрос в users сервис на id пользователя
        2. Запрос в БД постов
    * Запрос на создание поста
        1. Запрос auth сервиса аутентифицирован ли пользователь
        2. Запрос auth сервиса получения id пользователя для сохранения его в БД сервиса постов
        3. Запрос в БД на создание
    * Запрос на изменение поста
        1. Запрос auth сервиса аутентифицирован ли пользователь
        2. Запрос auth сервиса получения id пользователя для проверки его ли это пост
        3. Запрос на изменение поста в БД
    * Запрос на удаление поста
        1. Запрос auth сервиса аутентифицирован ли пользователь
        2. Запрос auth сервиса получения id пользователя для проверки его ли это пост
        3. Запрос на удаление поста в БД
    * Запрос определённого поста из БД
7) Service frends — работа с социальными отношениями между людьми. Данные в таблице хранятся по трёхбитовой системе (000 — никто, 100 — запрос дружбы отправлен от первого ко второму, 001 — запрос дружбы отправлен от второго к первому, 010 — друзья). Такое хранение позволяет одной записью описывать отношения между двумя пользователями. Можно было денормализировать БД и хранить друзей как строку id, но при большом количестве пользователей строки становятся слишком объёмными. API:
    1. Запрос на изменение отношения с другим пользователем
        1. Запрос auth сервиса аутентифицирован ли пользователь
        2. Запрос в БД на изменение
    2. Запрос на выборку друзей пользователя
        1. Запрос в users сервис на id пользователя
        2. Запрос в БД друзей
Неполадки на серверах можно «компенсировать» с помощью Null object pattern
__________________________________________________________________________
Полезные ссылки:
* MySQL for C/C++: [github + docs](https://github.com/mysql/mysql-connector-cpp) 
